<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>aksels.io | KFC - Soda cup exploit - (almost) Free drinks (as before)</title>
  <meta name="description" content="THIS ONLY WORKS IN FRANCE.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="KFC - Soda cup exploit - (almost) Free drinks (as before)">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://aksels.io//posts/kfc-soda-cup-exploit-france">
  <meta property="og:description" content="THIS ONLY WORKS IN FRANCE.">
  <meta property="og:site_name" content="aksels.io">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://aksels.io//posts/kfc-soda-cup-exploit-france">
  <meta name="twitter:title" content="KFC - Soda cup exploit - (almost) Free drinks (as before)">
  <meta name="twitter:description" content="THIS ONLY WORKS IN FRANCE.">

  
    <meta property="og:image" content="http://aksels.io//assets/images/og-image-e0267d2ca97a365674cea02986fb727242a5c6f726f5f4bb8429cf6309a1e2e7.png">
    <meta name="twitter:image" content="http://aksels.io//assets/images/og-image-e0267d2ca97a365674cea02986fb727242a5c6f726f5f4bb8429cf6309a1e2e7.png">
  

  <link href="http://aksels.io//feed.xml" type="application/rss+xml" rel="alternate" title="aksels.io Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/images/favicon-e1810e55450cd7b7c084c120c3ceb174127d8bf99422206d52f0f1483efb363b.ico">
      <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-c3e2522a554b073723f78d15a3bbe4f733e5fbc47d17ddd75507d501952ce40b.png">
      <link rel="stylesheet" type="text/css" href="/assets/stylesheets/light-5c5120be982c73be33337d6874234b0f1134870c5708299e30f63c995a9db4dd.css">
    

  
  
</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="aksels.io">aksels.io</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://twitter.com/AkselsLedins" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/icons/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/icons/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/AkselsLedins" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/icons/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/icons/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/akselsledins" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/icons/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/icons/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://www.flickr.com/photos/aksels" rel="noreferrer noopener" target="_blank" title="Flickr">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-flickr">
  <use href="/assets/icons/flickr-73bf82174abba7ac782ff99680b6fd93b89ac52518e1e19cc641068909cfe114.svg#icon-flickr" xlink:href="/assets/icons/flickr-73bf82174abba7ac782ff99680b6fd93b89ac52518e1e19cc641068909cfe114.svg#icon-flickr"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://instagram.com/aksels.ledins" rel="noreferrer noopener" target="_blank" title="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-instagram">
  <use href="/assets/icons/instagram-37f85bc75b43ecc4c114d9a46f846327fe13c5893787c6afbcfef9d30d58bd9e.svg#icon-instagram" xlink:href="/assets/icons/instagram-37f85bc75b43ecc4c114d9a46f846327fe13c5893787c6afbcfef9d30d58bd9e.svg#icon-instagram"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:aksels.ledins@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/icons/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/icons/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
  </ul>
</nav>

        <article class="article scrollappear">
          <header class="article-header">
            <h1>KFC - Soda cup exploit - (almost) Free drinks (as before)</h1>
            <p>THIS ONLY WORKS IN FRANCE.</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                March 20, 2017
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  3 min. read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/qrcode">qrcode</a>
                
                  <a href="/tag/exploit">exploit</a>
                
                  <a href="/tag/diy">diy</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p><br />
<br /></p>
<blockquote>
  <p>DISCLAIMER:<br />
<small>Of course you shouldn’t do this without buying another cup. </small>
<br /><small>Actually you shouldn’t do this at all because someone will get a non-working cup.</small></p>
</blockquote>

<p><br />
<br /></p>

<h1 id="introduction">Introduction</h1>

<p>This weekend we went to KFC with a bunch of friends and we were surprised to discover that the
soda fountain was no longer at will. Not that I’m a fan of soda, but the system set up to limit
the drinks was quite surprising/complex for a fast-food.</p>

<p><a>
  <img src="/assets/images/kfc/kfc_cup-f4d5a9acf59b5efcad1b453ae3124b84726ad70cfd15d8256dbae0b29d5ebaaa.jpg" alt="KFC Cup." class="zooming" data-rjs="/assets/images/kfc/kfc_cup@2x-7dd0b531a8c1e96c7c3af1fb5fbf46ca792451cc9c09736e155a9e4fef636d6a.jpg" data-zooming-width="" data-zooming-height="" />
</a></p>

<blockquote>
  <p><small><small>nb: after a little research, self-service soda fountains are now prohibited in France since January 2017</small></small></p>
</blockquote>

<p><a>
  <img src="/assets/images/kfc/why-57179cb82d83b64900166fc1620a61733c5caca3885ea32f224818323cae3438.jpg" alt="why." class="zooming" data-rjs="/assets/images/kfc/why-57179cb82d83b64900166fc1620a61733c5caca3885ea32f224818323cae3438.jpg" data-zooming-width="" data-zooming-height="" />
</a></p>

<p>Now in KFCs in France you need to scan your cup in order to get it filled. Of course you can do it
only once, if you try to scan your cup again you will be denied.</p>

<p>As a tech guy, my first reflex was to scan the QR Code without much conviction to find something of
great interest as I expected some crypted content.</p>

<hr />
<p><br /></p>
<h1 id="guess-what-">Guess what ?</h1>
<p><br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WBCB;SERVICE;1;3005970;40
</code></pre></div></div>

<p>This is the content of the QR Code. Plain text.</p>

<p>The first thing that came to my mind is that:</p>
<ul>
  <li><code class="highlighter-rouge">40</code> was the <em>capacity in CL</em> of the cup (and the amount poured into it) <br />— and I was right</li>
  <li><code class="highlighter-rouge">3005970</code> was the ID of the cup — and I was almost right</li>
</ul>

<p>My friends’ cups ID pattern were:</p>
<ul>
  <li><code class="highlighter-rouge">300597x</code> for a <em>40cl</em> cup</li>
  <li><code class="highlighter-rouge">400xxxx</code> for a <em>50cl</em> cup</li>
</ul>

<p>Actually the cup id was the 4 last digits, the first 3 digits were related to the size of the cup.</p>

<p>I tried to increment my ID by <strong>1000</strong>. It didn’t work, my QR Code did get denied. We tried to
increment it by <strong>80</strong> and .. <strong>it worked</strong> !</p>

<h3 id="assumption">Assumption</h3>

<p>Maybe the KFC staff receive these cups in large boxes and they need to scan them (the boxes) in order
to activate the cups. That would explain why it did not work when we incremented the id by a thousand.</p>

<hr />
<p><br /></p>
<h1 id="thoughts-on-how-to-protect-these-cups">Thoughts on how to protect these cups</h1>
<p><br /></p>

<h5 id="aes-encryption-256-bit">AES Encryption 256 bit</h5>
<p><a>
  <img src="/assets/images/kfc/aes_solution-ee51e8b35d569e7f99ad9b47e5fb5c2d6e392839f900b4b3a8a0a170c7f6c016.png" alt="AES Encryption" class="zooming" data-rjs="/assets/images/kfc/aes_solution-ee51e8b35d569e7f99ad9b47e5fb5c2d6e392839f900b4b3a8a0a170c7f6c016.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<p>Encrypting the QR Code content with a 256bit private key would certainly solve this problem.
The scanner could decrypt the content without any problem nor delay.</p>

<p><br /></p>
<h5 id="move-the-fountain-behind-the-counter">Move the fountain behind the counter</h5>
<p><a>
  <img src="/assets/images/kfc/counter_solution-e0ce5092eebb157ecd5ab51a7a7cbc6c629baad42dc555d6aff087f8b1a07033.png" alt="Easiest solution - Move fountain + remove QR Codes." class="zooming" data-rjs="/assets/images/kfc/counter_solution-e0ce5092eebb157ecd5ab51a7a7cbc6c629baad42dc555d6aff087f8b1a07033.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<p>… like in 95% of fast-foods. And just serve the cups filled.</p>

<p><br /><br /><br /></p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=KFC+-+Soda+cup+exploit+-+(almost)+Free+drinks+(as+before)%20-%20http://aksels.io//posts/kfc-soda-cup-exploit-france%20by%20@AkselsLedins" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://aksels.io//posts/kfc-soda-cup-exploit-france" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
            <a href="https://plus.google.com/share?url=http://aksels.io//posts/kfc-soda-cup-exploit-france" title="Share on Google+" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 128 128"><path d="M40.7 55.9v16.1c0 0 15.6 0 22 0C59.2 82.5 53.8 88.2 40.7 88.2c-13.3 0-23.7-10.8-23.7-24.2s10.4-24.2 23.7-24.2c7.1 0 11.6 2.5 15.8 5.9 3.3-3.3 3.1-3.8 11.6-11.9 -7.2-6.6-16.8-10.6-27.4-10.6C18.2 23.3 0 41.5 0 64c0 22.5 18.2 40.7 40.7 40.7 33.6 0 41.8-29.3 39-48.8H40.7zM113.9 56.7V42.6h-10.1v14.1H89.4v10.1h14.5v14.5h10.1V66.8H128V56.7H113.9z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://aksels.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer reveal">
  <p>
    <a href="/about">An enthusiastic French Software Engineer.</a>
    <br/>
    <br/>
    <div>
      <span style="width:100px;display:inline-block">Personal</span> <a target="_blank" href="https://aksels.me">aksels.me</a><br/>
    <div>
    <div>
      <span style="width:100px;display:inline-block">Blog</span> <a target="_blank" href="https://aksels.io">aksels.io</a>
    </div>
    <div>
      <span style="width:100px;display:inline-block">Freelancing</span> <a target="_blank" href="https://hypermoon.io">hypermoon.io</a>
    </div>
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-88694407-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-88694407-1');
  </script>


<script src="/assets/javascripts/vendor-9a9dd357c523104bebaea02251409e037c69b20c285bdfbc6961ef0245cf9c11.js" type="text/javascript"></script>


  <script src="/assets/javascripts/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/javascripts/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/javascripts/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


</body>
</html>
